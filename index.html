<!DOCTYPE html>
<html lang="ka">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>áƒ”áƒ•áƒ áƒáƒáƒ£áƒšáƒ˜ áƒ¡áƒ™áƒáƒšáƒ˜áƒ¡ áƒ¡áƒáƒ‘áƒáƒ–áƒ áƒ¡áƒáƒ¤áƒ”áƒ®áƒ£áƒ áƒ˜áƒ¡ áƒ¬áƒ˜áƒ’áƒœáƒ”áƒ‘áƒ˜</title>
  <style>
    :root{
      --blue:#1d4ed8;
      --blue-50:#eff6ff;
      --indigo-50:#eef2ff;
      --text:#0f172a;
      --muted:#64748b;
      --white:#ffffff;
      --radius:18px;
      --yellow:#facc15;
      --danger:#dc2626;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      color:var(--text);
      background:var(--white);
      display:flex;
      flex-direction:column;
      align-items:stretch;
    }

    header{padding:32px 16px 6px; text-align:center;}
    h1{margin:0 0 8px; font-size:clamp(22px,3vw,36px); font-weight:800; color:#000}
    .subtitle{color:var(--muted); font-size:14px;}

    .hidden{display:none !important;}

    .home-grid{display:flex; justify-content:center; gap:28px; flex-wrap:wrap; padding:28px 16px 12px;}
    .grade-btn{
      width:min(320px,90vw);
      height:160px;
      border-radius:var(--radius);
      cursor:pointer;
      background:linear-gradient(180deg,var(--blue-50),#ffffff);
      border:1px solid #e5e7eb;
      box-shadow:0 8px 24px rgba(2,6,23,0.08);
      display:flex;
      align-items:center;
      justify-content:center;
      text-align:center;
      color:var(--blue);
      font-weight:700;
      font-size:22px;
      transition:transform .2s ease, box-shadow .2s ease;
    }
    .grade-btn:hover{transform:translateY(-3px); box-shadow:0 14px 32px rgba(2,6,23,0.12)}

    .eu-stars{margin-top:auto; background:var(--indigo-50); padding:18px 0;}
    .stars-wrap{display:flex; justify-content:center; gap:10px;}
    .star{font-size:28px; line-height:1; color:var(--yellow); filter: drop-shadow(0 1px 0 rgba(0,0,0,.2));}

    .topbar{display:flex; align-items:center; justify-content:space-between; gap:12px; padding:18px 16px; border-bottom:1px solid #e5e7eb;}
    .topbar-left{display:flex; align-items:center; gap:12px;}
    .back{appearance:none; border:none; background:var(--blue); color:white; border-radius:12px; padding:10px 14px; font-weight:600; cursor:pointer; box-shadow:0 6px 16px rgba(29,78,216,.3)}
    .top-title{margin:0; font-size:20px; font-weight:800}

    .rightbar{display:flex; align-items:center; gap:10px;}
    .user-pill{font-size:13px; color:#0b1220; background:#f1f5f9; border:1px solid #e2e8f0; border-radius:999px; padding:8px 10px; display:flex; align-items:center; gap:8px;}
    .dot{width:8px; height:8px; border-radius:50%; background:#94a3b8; display:inline-block;}
    .dot.admin{background:#22c55e;}

    .btn{appearance:none; border:1px solid #e5e7eb; background:#fff; color:#111827; border-radius:12px; padding:8px 12px; font-weight:600; cursor:pointer; text-decoration:none;}
    .btn.primary{background:var(--blue); color:#fff; border-color:transparent;}

    .slots{width:min(1100px,92vw); margin:22px auto 40px; display:grid; grid-template-columns:repeat(3,1fr); gap:16px;}
    @media (max-width:900px){.slots{grid-template-columns:repeat(2,1fr);}}
    @media (max-width:560px){.slots{grid-template-columns:1fr;}}

    .slot{
      min-height:150px;
      border-radius:16px;
      background:#ffffff;
      border:1px dashed var(--blue);
      display:flex;
      align-items:center;
      justify-content:center;
      padding:14px;
      text-align:center;
      color:var(--blue);
      transition:background .15s ease, box-shadow .15s ease;
      cursor:pointer;
    }
    .slot:hover{background:#eef2ff; box-shadow:0 6px 18px rgba(29,78,216,.15)}
    .slot.filled{border-style:solid; border-color:#e5e7eb; color:var(--text)}
    .slot.readonly{cursor:default;}
    .slot.readonly:hover{background:#fff; box-shadow:none;}

    .card{width:100%; display:grid; grid-template-columns:56px 1fr auto; gap:12px; align-items:center;}
    .thumb{width:56px; height:56px; border-radius:12px; background:#eef2ff; color:#1e3a8a; display:flex; align-items:center; justify-content:center; font-size:24px; flex:0 0 auto}
    .meta{min-width:0; text-align:left; display:flex; flex-direction:column; gap:4px}
    .name{font-weight:700; font-size:16px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; max-width:100%}
    .desc{font-size:13px; color:var(--muted); overflow:hidden; display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; max-height:3em}

    dialog{border:none; padding:0; border-radius:16px; box-shadow:0 24px 60px rgba(2,6,23,.35); width:min(720px,94vw)}
    dialog::backdrop{background:rgba(2,6,23,.45)}
    .modal{padding:18px;}
    .row{display:grid; grid-template-columns:140px 1fr; gap:12px; align-items:center; margin-top:12px;}
    .label{text-align:right; font-size:14px; color:#64748b}
    input[type="text"], textarea{width:100%; padding:10px 12px; border-radius:12px; border:1px solid #e5e7eb; font:inherit;}
    textarea{min-height:90px; resize:vertical;}
    .seg{display:flex; gap:10px; align-items:center; flex-wrap:wrap;}
    .help{font-size:12px; color:#64748b; margin-top:6px;}
    .warn{font-size:12px; color:var(--danger); margin-top:10px;}
    .modal-actions{display:flex; justify-content:flex-end; gap:10px; margin-top:16px;}

    /* login */
    .login-shell{padding:18px;}
    .login-title{margin:0; font-size:18px; font-weight:800;}
    .login-sub{margin:6px 0 0; color:var(--muted); font-size:13px;}
    .login-actions{display:flex; justify-content:flex-end; gap:10px; margin-top:14px;}
  </style>
</head>
<body>
  <!-- LOGIN GATE -->
  <dialog id="login" aria-label="Login">
    <form class="login-shell" method="dialog">
      <h3 class="login-title">áƒ›áƒáƒ›áƒ®áƒ›áƒáƒ áƒ”áƒ‘áƒšáƒ˜áƒ¡ áƒ¡áƒáƒ®áƒ”áƒšáƒ˜</h3>
      <p class="login-sub">áƒ¨áƒ”áƒ˜áƒ§áƒ•áƒáƒœáƒ”áƒ— áƒ¡áƒáƒ®áƒ”áƒšáƒ˜.</p>
      <div style="margin-top:12px">
        <input id="loginName" type="text" placeholder="áƒ›áƒáƒ’: Sandro" autocomplete="username" required />
        <div id="loginErr" class="warn hidden">áƒ’áƒ—áƒ®áƒáƒ•áƒ— áƒ¨áƒ”áƒ˜áƒ§áƒ•áƒáƒœáƒáƒ— áƒ¡áƒáƒ®áƒ”áƒšáƒ˜.</div>
      </div>
      <div class="login-actions">
        <button class="btn primary" type="submit">áƒ¨áƒ”áƒ¡áƒ•áƒšáƒ</button>
      </div>
    </form>
  </dialog>

  <!-- HOME -->
  <header id="home-header">
    <h1>áƒ”áƒ•áƒ áƒáƒáƒ£áƒšáƒ˜ áƒ¡áƒ™áƒáƒšáƒ˜áƒ¡ áƒ¡áƒáƒ‘áƒáƒ–áƒ áƒ¡áƒáƒ¤áƒ”áƒ®áƒ£áƒ áƒ˜áƒ¡ áƒ¬áƒ˜áƒ’áƒœáƒ”áƒ‘áƒ˜</h1>
    <div class="subtitle">áƒáƒ˜áƒ áƒ©áƒ˜áƒ”áƒ— áƒ™áƒšáƒáƒ¡áƒ˜áƒ¡ áƒ‘áƒ˜áƒ‘áƒšáƒ˜áƒáƒ—áƒ”áƒ™áƒ</div>
  </header>
  <main id="home" aria-label="Homepage">
    <div class="home-grid">
      <button class="grade-btn" data-grade="6">6 áƒ™áƒšáƒáƒ¡áƒ˜áƒ¡ áƒ¬áƒ˜áƒ’áƒœáƒ”áƒ‘áƒ˜</button>
      <button class="grade-btn" data-grade="7">7 áƒ™áƒšáƒáƒ¡áƒ˜áƒ¡ áƒ¬áƒ˜áƒ’áƒœáƒ”áƒ‘áƒ˜</button>
      <button class="grade-btn" data-grade="8">8 áƒ™áƒšáƒáƒ¡áƒ˜áƒ¡ áƒ¬áƒ˜áƒ’áƒœáƒ”áƒ‘áƒ˜</button>
    </div>
  </main>

  <!-- GRADE PAGE -->
  <section id="grade-page" class="hidden" aria-label="Grade library">
    <div class="topbar">
      <div class="topbar-left">
        <button class="back" id="backBtn">â† áƒ›áƒ—áƒáƒ•áƒáƒ áƒ˜</button>
        <h2 class="top-title" id="gradeTitle">áƒ™áƒšáƒáƒ¡áƒ˜áƒ¡ áƒ‘áƒ˜áƒ‘áƒšáƒ˜áƒáƒ—áƒ”áƒ™áƒ</h2>
      </div>
      <div class="rightbar">
        <button class="btn" id="changeUserBtn" type="button">áƒ›áƒáƒ›áƒ®áƒ›áƒáƒ áƒ”áƒ‘áƒšáƒ˜áƒ¡ áƒ¨áƒ”áƒªáƒ•áƒšáƒ</button>
        <div class="user-pill" title="User status">
          <span id="userDot" class="dot"></span>
          <span id="userLabel">â€”</span>
        </div>
      </div>
    </div>
    <div class="slots" id="slots"></div>
  </section>

  <footer class="eu-stars">
    <div class="stars-wrap" aria-hidden="true">
      <span class="star">â˜…</span><span class="star">â˜…</span><span class="star">â˜…</span><span class="star">â˜…</span><span class="star">â˜…</span>
      <span class="star">â˜…</span><span class="star">â˜…</span><span class="star">â˜…</span><span class="star">â˜…</span><span class="star">â˜…</span><span class="star">â˜…</span>
    </div>
  </footer>

  <!-- EDITOR (ADMIN ONLY) -->
  <dialog id="editor" aria-label="Editor">
    <form class="modal" method="dialog">
      <h3 style="margin:0 0 8px; font-size:18px; font-weight:800">áƒ¡áƒšáƒáƒ¢áƒ˜áƒ¡ áƒ áƒ”áƒ“áƒáƒ¥áƒ¢áƒ˜áƒ áƒ”áƒ‘áƒ</h3>
      <p class="login-sub">áƒ áƒ”áƒ“áƒáƒ¥áƒ¢áƒ˜áƒ áƒ”áƒ‘áƒ˜áƒ¡ áƒ£áƒ¤áƒšáƒ”áƒ‘áƒ áƒáƒ¥áƒ•áƒ¡ áƒ›áƒ®áƒáƒšáƒáƒ“ áƒáƒ“áƒ›áƒ˜áƒœáƒ˜áƒ¡áƒ¢áƒ áƒáƒ¢áƒáƒ áƒ¡.</p>
      <input type="hidden" id="f-id" />
      <input type="hidden" id="f-grade" />
      <input type="hidden" id="f-slot" />

      <div class="row">
        <div class="label">áƒ¡áƒáƒ®áƒ”áƒšáƒ˜</div>
        <input id="f-name" type="text" placeholder="áƒ›áƒáƒ’: áƒ›áƒáƒ—áƒ”áƒ›áƒáƒ¢áƒ˜áƒ™áƒ â€” áƒ—áƒáƒ•áƒ˜ 1" required />
      </div>

      <div class="row">
        <div class="label">áƒáƒ¦áƒ¬áƒ”áƒ áƒ</div>
        <textarea id="f-desc" placeholder="áƒ›áƒáƒ™áƒšáƒ” áƒáƒ¦áƒ¬áƒ”áƒ áƒ (áƒáƒ áƒáƒ¡áƒáƒ•áƒáƒšáƒ“áƒ”áƒ‘áƒ£áƒšáƒ)"></textarea>
      </div>

      <div class="row">
        <div class="label">PDF áƒ¢áƒ˜áƒáƒ˜</div>
        <div class="seg">
          <label><input type="radio" name="pdfType" value="link" checked> áƒ‘áƒ›áƒ£áƒšáƒ˜</label>
          <label><input type="radio" name="pdfType" value="file"> áƒ¤áƒáƒ˜áƒšáƒ˜</label>
        </div>
      </div>

      <div class="row" id="rowLink">
        <div class="label">PDF áƒ‘áƒ›áƒ£áƒšáƒ˜</div>
        <div>
          <input id="f-url" type="text" placeholder="https://... (PDF link)" />
          <div class="help">áƒ—áƒ£ áƒáƒ  áƒ¬áƒ”áƒ  http/https-áƒ¡, áƒ¡áƒ˜áƒ¡áƒ¢áƒ”áƒ›áƒ áƒáƒ•áƒ¢áƒáƒ›áƒáƒ¢áƒ£áƒ áƒáƒ“ áƒ“áƒáƒáƒ›áƒáƒ¢áƒ”áƒ‘áƒ¡.</div>
        </div>
      </div>

      <div class="row hidden" id="rowFile">
        <div class="label">PDF áƒ¤áƒáƒ˜áƒšáƒ˜</div>
        <div>
          <input id="f-pdf" type="file" accept="application/pdf" />
          <div class="help">áƒ¤áƒáƒ˜áƒšáƒ”áƒ‘áƒ˜ áƒ˜áƒœáƒáƒ®áƒ”áƒ‘áƒ áƒáƒ›áƒáƒ•áƒ” áƒ‘áƒ áƒáƒ£áƒ–áƒ”áƒ áƒ¨áƒ˜ (IndexedDB) áƒ“áƒ áƒ áƒ©áƒ”áƒ‘áƒ áƒ’áƒáƒ“áƒáƒ¢áƒ•áƒ˜áƒ áƒ—áƒ•áƒ˜áƒ¡ áƒ¨áƒ”áƒ›áƒ“áƒ”áƒ’áƒáƒª.</div>
        </div>
      </div>

      <div id="saveErr" class="warn hidden"></div>

      <div class="modal-actions">
        <button class="btn" value="cancel">áƒ’áƒáƒ£áƒ¥áƒ›áƒ”áƒ‘áƒ</button>
        <button class="btn primary" type="submit">áƒ¨áƒ”áƒœáƒáƒ®áƒ•áƒ</button>
      </div>
    </form>
  </dialog>

  <script>
  /********************
   * Seed data (Grade 6)
   ********************/
  const SEED_ITEMS_GRADE_6 = [
    { grade:'6', slotIndex:0, name:'áƒ¥áƒáƒ áƒ—áƒ£áƒšáƒ˜ 6 áƒ™áƒšáƒáƒ¡áƒ˜ I áƒœáƒáƒ¬áƒ˜áƒšáƒ˜', pdfType:'link', pdfUrl:'https://www.calameo.com/read/0056301201d3913e6dcbd', description:'' },
    { grade:'6', slotIndex:1, name:'áƒ›áƒáƒ—áƒ”áƒ›áƒáƒ¢áƒ˜áƒ™áƒ 6 áƒ™áƒšáƒáƒ¡áƒ˜ I áƒœáƒáƒ¬áƒ˜áƒšáƒ˜', pdfType:'link', pdfUrl:'https://www.scribd.com/document/613973857/%E1%83%9B%E1%83%94-6-%E1%83%99%E1%83%9A%E1%83%90%E1%83%A1%E1%83%98-%E1%83%95%E1%83%94%E1%83%A4%E1%83%AE%E1%83%95%E1%83%90%E1%83%AB%E1%83%94', description:'' },
    { grade:'6', slotIndex:2, name:'áƒ©áƒ”áƒ›áƒ˜ áƒ¡áƒáƒ¥áƒáƒ áƒ—áƒ•áƒ”áƒšáƒ', pdfType:'link', pdfUrl:'https://klio.ge/3d-flip-book/%E1%83%A9%E1%83%95%E1%83%94%E1%83%9C%E1%83%98-%E1%83%A1%E1%83%90%E1%83%A5%E1%83%90%E1%83%A0%E1%83%97%E1%83%95%E1%83%94%E1%83%9A%E1%83%9D-vi-%E1%83%99%E1%83%9A%E1%83%90%E1%83%A1%E1%83%98-%E1%83%9B-2/', description:'' },
    { grade:'6', slotIndex:3, name:'áƒ¥áƒáƒ áƒ—áƒ£áƒšáƒ˜ II áƒœáƒáƒ¬áƒ˜áƒšáƒ˜ 6 áƒ™áƒšáƒáƒ¡áƒ˜', pdfType:'link', pdfUrl:'https://www.calameo.com/read/00563012078f752b8945f', description:'' },
    { grade:'6', slotIndex:4, name:'áƒ¥áƒáƒ áƒ—áƒ£áƒšáƒ˜ áƒ”áƒœáƒ', pdfType:'link', pdfUrl:'https://www.calameo.com/read/005630120604f6b6d0006', description:'' },
    { grade:'6', slotIndex:5, name:'áƒ‘áƒ£áƒœáƒ”áƒ‘áƒ I', pdfType:'link', pdfUrl:'https://fliphtml5.com/njlgv/xqxr/%E1%83%91%E1%83%A3%E1%83%9C%E1%83%94%E1%83%91%E1%83%90_6_-_%E1%83%9B%E1%83%9D%E1%83%A1%E1%83%AC%E1%83%90%E1%83%95%E1%83%9A%E1%83%98%E1%83%A1_%E1%83%AC%E1%83%98%E1%83%92%E1%83%9C%E1%83%98_-_%E1%83%9C%E1%83%90%E1%83%AC%E1%83%98%E1%83%9A%E1%83%98_1/', description:'' },
    { grade:'6', slotIndex:6, name:'áƒ®áƒ”áƒšáƒáƒ•áƒœáƒ”áƒ‘áƒ', pdfType:'link', pdfUrl:'https://klio.ge/wp-content/uploads/2023/06/6-%E1%83%AE%E1%83%94%E1%83%9A%E1%83%9D%E1%83%95%E1%83%9C%E1%83%94%E1%83%91%E1%83%90-%E1%83%9B%E1%83%90%E1%83%A1%E1%83%AC%E1%83%90%E1%83%95%E1%83%9A%E1%83%94%E1%83%91%E1%83%9A%E1%83%98%E1%83%A1-%E1%83%AC%E1%83%98%E1%83%92%E1%83%9C%E1%83%98.pdf', description:'' }
  ];

  /********************
   * Seed data (Grade 7)
   ********************/
  const SEED_ITEMS_GRADE_7 = [
    { grade:'7', slotIndex:0, name:'áƒ¥áƒáƒ áƒ—áƒ£áƒšáƒ˜ I', pdfType:'link', pdfUrl:'https://www.calameo.com/read/00563012046abee5b9c2e', description:'' },
    { grade:'7', slotIndex:1, name:'áƒ¥áƒáƒ áƒ—áƒ£áƒšáƒ˜ II', pdfType:'link', pdfUrl:'https://www.calameo.com/read/0056301207d41a8e8f999', description:'' },
    { grade:'7', slotIndex:2, name:'áƒ¥áƒáƒ áƒ—áƒ£áƒšáƒ˜ áƒ”áƒœáƒ', pdfType:'link', pdfUrl:'https://www.calameo.com/read/005630120fd61c72fabf5', description:'' },
    { grade:'7', slotIndex:3, name:'áƒ›áƒáƒ—áƒ”áƒ›áƒáƒ¢áƒ˜áƒ™áƒ I áƒœáƒáƒ¬áƒ˜áƒšáƒ˜', pdfType:'link', pdfUrl:'https://www.scribd.com/document/613974128/%E1%83%9B%E1%83%94-7-%E1%83%99%E1%83%9A%E1%83%90%E1%83%A1%E1%83%98-%E1%83%9B%E1%83%90%E1%83%97%E1%83%94%E1%83%9B%E1%83%90%E1%83%A2%E1%83%98%E1%83%99%E1%83%90', description:'' },
    { grade:'7', slotIndex:4, name:'áƒ’áƒ”áƒáƒ’áƒ áƒáƒ¤áƒ˜áƒ II', pdfType:'link', pdfUrl:'https://online.fliphtml5.com/njlgv/dpzl/', description:'' },
    { grade:'7', slotIndex:5, name:'áƒ˜áƒ¡áƒ¢áƒáƒ áƒ˜áƒ', pdfType:'link', pdfUrl:'https://www.scribd.com/document/554903611/%E1%83%98%E1%83%A1%E1%83%A2%E1%83%9D%E1%83%A0%E1%83%98%E1%83%90-7-%E1%83%9B%E1%83%9D%E1%83%A1%E1%83%AC%E1%83%90%E1%83%95%E1%83%9A%E1%83%98%E1%83%A1', description:'' },
    { grade:'7', slotIndex:6, name:'áƒ áƒ£áƒ¡áƒ£áƒšáƒ˜ áƒ¬áƒ˜áƒ’áƒœáƒ˜', pdfType:'link', pdfUrl:'https://drive.google.com/file/d/13nEVwBmkXoLy8zui0FYGykr5GIRl7-Z8/view', description:'' },
    { grade:'7', slotIndex:7, name:'áƒ áƒ£áƒ¡áƒ£áƒšáƒ˜ áƒ áƒ•áƒ”áƒ£áƒšáƒ˜', pdfType:'link', pdfUrl:'https://drive.google.com/file/d/1K3JwkK3wVSvOp7sjrP7DgpT_i9CjEsv1/view', description:'' },
    { grade:'7', slotIndex:8, name:'áƒ®áƒ”áƒšáƒáƒ•áƒœáƒ”áƒ‘áƒ 7 áƒ™áƒšáƒáƒ¡áƒ˜', pdfType:'link', pdfUrl:'https://klio.ge/wp-content/uploads/2023/06/7-%E1%83%AE%E1%83%94%E1%83%9A%E1%83%9D%E1%83%95%E1%83%9C%E1%83%94%E1%83%91%E1%83%90-%E1%83%9B%E1%83%90%E1%83%A1%E1%83%AC%E1%83%90%E1%83%95%E1%83%9A%E1%83%94%E1%83%91%E1%83%9A%E1%83%98%E1%83%A1-%E1%83%AC%E1%83%98%E1%83%92%E1%83%9C%E1%83%98.pdf', description:'' }
  ];

  /********************
   * Seed data (Grade 8)
   ********************/
  const SEED_ITEMS_GRADE_8 = [
    { grade:'8', slotIndex:0, name:'áƒ¥áƒáƒ áƒ—áƒ£áƒšáƒ˜ I', pdfType:'link', pdfUrl:'https://www.calameo.com/read/00563012046abee5b9c2e', description:'' },
    { grade:'8', slotIndex:1, name:'áƒ¥áƒáƒ áƒ—áƒ£áƒšáƒ˜ II', pdfType:'link', pdfUrl:'https://www.calameo.com/read/0056301207d41a8e8f999', description:'' },
    { grade:'8', slotIndex:2, name:'áƒ¥áƒáƒ áƒ—áƒ£áƒšáƒ˜ áƒ’áƒ áƒáƒ›áƒáƒ¢áƒ˜áƒ™áƒ', pdfType:'link', pdfUrl:'https://www.calameo.com/read/005630120fd61c72fabf5', description:'' },
    { grade:'8', slotIndex:3, name:'áƒ˜áƒ¡áƒ¢áƒáƒ áƒ˜áƒ', pdfType:'link', pdfUrl:'https://drive.google.com/file/d/1gYJy3ntHKAtAvY8J_XzpYUKK1svOeJG1/view', description:'' },
    { grade:'8', slotIndex:4, name:'áƒ’áƒ”áƒáƒ’áƒ áƒáƒ¤áƒ˜áƒ 8', pdfType:'link', pdfUrl:'https://fliphtml5.com/njlgv/owsb/áƒ’áƒ”áƒáƒ’áƒ áƒáƒ¤áƒ˜áƒ_8_-_áƒ›áƒáƒ¡áƒ¬áƒáƒ•áƒšáƒ˜áƒ¡_áƒ¬áƒ˜áƒ’áƒœáƒ˜/171/', description:'' },
    { grade:'8', slotIndex:5, name:'áƒ˜áƒ¡áƒ¢áƒáƒ áƒ˜áƒ áƒ áƒ•áƒ”áƒ£áƒšáƒ˜', pdfType:'link', pdfUrl:'https://drive.google.com/file/d/1-9qb5ycKcXQdFDMBKLpUUYsy2qvUX4Ef/view', description:'' },
    { grade:'8', slotIndex:6, name:'áƒ áƒ£áƒ¡áƒ£áƒšáƒ˜ áƒ¬áƒ˜áƒ’áƒœáƒ˜', pdfType:'link', pdfUrl:'https://drive.google.com/file/d/1QyxeUxxbfLGeTiW0KUfciT_NsYcCzUJ0/view', description:'' },
    { grade:'8', slotIndex:7, name:'áƒ áƒ£áƒ¡áƒ£áƒšáƒ˜ áƒ áƒ•áƒ”áƒ£áƒšáƒ˜', pdfType:'link', pdfUrl:'https://drive.google.com/file/d/1etJe3A26kjIDStH6NP-Eczn3KGe6lG3b/view', description:'' },
    { grade:'8', slotIndex:8, name:'áƒ˜áƒœáƒ’áƒšáƒ˜áƒ¡áƒ£áƒ áƒ˜ áƒ¬áƒ˜áƒ’áƒœáƒ˜', pdfType:'link', pdfUrl:'https://online.fliphtml5.com/jhjed/ytcv/#p=1', description:'' },
    { grade:'8', slotIndex:9, name:'áƒ˜áƒœáƒ’áƒšáƒ˜áƒ¡áƒ£áƒ áƒ˜ áƒ áƒ•áƒ”áƒ£áƒšáƒ˜', pdfType:'link', pdfUrl:'https://www.scribd.com/document/821288122/FOCUS-2-WORKBOOK', description:'' },
    { grade:'8', slotIndex:10, name:'áƒ¥áƒ˜áƒ›áƒ˜áƒ', pdfType:'link', pdfUrl:'https://saqmatsne.ge/wp-content/uploads/2020/06/Qimia_08_stud.pdf', description:'' },
    { grade:'8', slotIndex:11, name:'áƒ‘áƒ˜áƒáƒšáƒáƒ’áƒ˜áƒ II', pdfType:'link', pdfUrl:'https://www.scribd.com/document/498646570/áƒ›áƒáƒ¡áƒ¬áƒáƒ•áƒšáƒ˜áƒ¡-áƒ¬áƒ˜áƒ’áƒœáƒ˜-áƒ‘áƒ˜áƒáƒšáƒáƒ’áƒ˜áƒ-8-áƒ™áƒšáƒáƒ¡áƒ˜-áƒœáƒáƒ¬áƒ˜áƒšáƒ˜-2', description:'' },
    { grade:'8', slotIndex:12, name:'áƒ¤áƒ˜áƒ–áƒ˜áƒ™áƒ áƒ¬áƒ˜áƒ’áƒœáƒ˜', pdfType:'link', pdfUrl:'https://drive.google.com/drive/u/0/folders/1cSbDroJW2jE4Z7aIeNJbdIhCsDyX1gUB', description:'' },
    { grade:'8', slotIndex:13, name:'áƒ›áƒáƒ—áƒ”áƒ›áƒáƒ¢áƒ˜áƒ™áƒ II', pdfType:'link', pdfUrl:'https://drive.google.com/file/d/1PH5vToNBFOoenEvyD5vKsUGy6Jds0KUK/view?usp=sharing', description:'' }
  ];

  /********************
   * Username / Admin  *
   ********************/
  const ADMIN_NAME = 'Tonispuri';
  const USER_KEY = 'pdf_bank_username_v2';

  const loginDlg = document.getElementById('login');
  const loginName = document.getElementById('loginName');
  const loginErr = document.getElementById('loginErr');
  const changeUserBtn = document.getElementById('changeUserBtn');

  const userLabel = document.getElementById('userLabel');
  const userDot = document.getElementById('userDot');

  let currentUser = '';
  let isAdmin = false;

  function setUser(name){
    currentUser = (name || '').trim();
    isAdmin = currentUser === ADMIN_NAME;
    localStorage.setItem(USER_KEY, currentUser);
    userLabel.textContent = isAdmin ? `${currentUser} (Admin)` : currentUser;
    userDot.classList.toggle('admin', isAdmin);
  }

  function showLogin(){
    loginErr.classList.add('hidden');
    loginName.value = '';
    try{ loginDlg.showModal(); }catch{}
    setTimeout(()=> loginName.focus(), 50);
  }

  function ensureLogin(){
    const stored = (localStorage.getItem(USER_KEY) || '').trim();
    if(stored){ setUser(stored); return; }
    showLogin();
  }

  loginDlg.querySelector('form').addEventListener('submit', (e)=>{
    e.preventDefault();
    const name = loginName.value.trim();
    if(!name){ loginErr.classList.remove('hidden'); return; }
    setUser(name);
    loginDlg.close();
    if(currentGrade) renderSlots();
  });

  changeUserBtn.addEventListener('click', ()=>{
    localStorage.removeItem(USER_KEY);
    showLogin();
  });

  /********************
   * IndexedDB storage *
   ********************/
  const DB_NAME = 'pdf_bank_links_files_v2';
  const DB_VERSION = 1;
  const STORE = 'items';

  function openDB(){
    return new Promise((resolve, reject)=>{
      const req = indexedDB.open(DB_NAME, DB_VERSION);
      req.onupgradeneeded = () => {
        const db = req.result;
        const store = db.createObjectStore(STORE, { keyPath:'id', autoIncrement:true });
        store.createIndex('by_grade', 'grade');
        store.createIndex('by_grade_slot', ['grade','slotIndex'], { unique:true });
      };
      req.onsuccess = ()=> resolve(req.result);
      req.onerror = ()=> reject(req.error);
    });
  }

  function tx(mode, fn){
    return openDB().then(db=> new Promise((resolve, reject)=>{
      const t = db.transaction(STORE, mode);
      const st = t.objectStore(STORE);
      fn(st, t);
      t.oncomplete = ()=> resolve();
      t.onerror = ()=> reject(t.error);
    }));
  }

  function getAllByGrade(grade){
    return openDB().then(db=> new Promise((resolve, reject)=>{
      const out=[];
      const t = db.transaction(STORE, 'readonly');
      const idx = t.objectStore(STORE).index('by_grade');
      const range = IDBKeyRange.only(String(grade));
      const curReq = idx.openCursor(range);
      curReq.onsuccess = e=>{
        const cur = e.target.result;
        if(cur){ out.push(cur.value); cur.continue(); }
        else resolve(out);
      };
      curReq.onerror = ()=> reject(curReq.error);
    }));
  }

  function getByGradeSlot(grade, slotIndex){
    return openDB().then(db=> new Promise((resolve, reject)=>{
      const t = db.transaction(STORE, 'readonly');
      const idx = t.objectStore(STORE).index('by_grade_slot');
      const req = idx.get([String(grade), Number(slotIndex)]);
      req.onsuccess = ()=> resolve(req.result || null);
      req.onerror = ()=> reject(req.error);
    }));
  }

  function putItem(item){
    return tx('readwrite', (st)=> st.put(item));
  }

  /********************
   * Navigation & UI   *
   ********************/
  const home = document.getElementById('home');
  const homeHeader = document.getElementById('home-header');
  const gradePage = document.getElementById('grade-page');
  const gradeTitle = document.getElementById('gradeTitle');
  const slotsEl = document.getElementById('slots');
  const backBtn = document.getElementById('backBtn');

  let currentGrade = null;
  const TOTAL_SLOTS = 15;

  document.querySelectorAll('.grade-btn').forEach(btn=>{
    btn.addEventListener('click', ()=> openGrade(btn.dataset.grade));
  });

  backBtn.addEventListener('click', ()=>{
    gradePage.classList.add('hidden');
    home.classList.remove('hidden');
    homeHeader.classList.remove('hidden');
    currentGrade = null;
    slotsEl.innerHTML = '';
  });

  async function openGrade(grade){
    currentGrade = String(grade);
    gradeTitle.textContent = `${grade} áƒ™áƒšáƒáƒ¡áƒ˜áƒ¡ áƒ¬áƒ˜áƒ’áƒœáƒ”áƒ‘áƒ˜áƒ¡ áƒ‘áƒ˜áƒ‘áƒšáƒ˜áƒáƒ—áƒ”áƒ™áƒ`;
    home.classList.add('hidden');
    homeHeader.classList.add('hidden');
    gradePage.classList.remove('hidden');
    await renderSlots();
  }

  function normalizeUrl(url){
    let u = (url || '').trim();
    if(!u) return '';
    if(!/^https?:\/\//i.test(u)) u = 'https://' + u;
    return u;
  }

  // pressing "áƒ’áƒáƒ®áƒ¡áƒœáƒ" ALWAYS opens the PDF
  function openPdfItem(item){
    if(!item) return;

    if(item.pdfType === 'file'){
      if(!item.pdfBlob){ alert('PDF áƒ¤áƒáƒ˜áƒšáƒ˜ áƒ•áƒ”áƒ  áƒ›áƒáƒ˜áƒ«áƒ”áƒ‘áƒœáƒ'); return; }
      const blobUrl = URL.createObjectURL(item.pdfBlob);
      const w = window.open(blobUrl, '_blank', 'noopener');
      setTimeout(()=> URL.revokeObjectURL(blobUrl), 60_000);
      if(!w) location.href = blobUrl;
      return;
    }

    const u = normalizeUrl(item.pdfUrl);
    if(!u) return;

    try{
      const w = window.open(u, '_blank', 'noopener');
      if(!w){
        const a = document.createElement('a');
        a.href = u;
        a.target = '_blank';
        a.rel = 'noopener noreferrer';
        document.body.appendChild(a);
        a.click();
        a.remove();
      }
    }catch(e){
      location.href = u;
    }
  }

  function renderOpenButton(item){
    const btn = document.createElement('button');
    btn.type = 'button';
    btn.className = 'btn';
    btn.textContent = 'áƒ’áƒáƒ®áƒ¡áƒœáƒ';
    btn.addEventListener('click', (e)=>{ e.preventDefault(); e.stopPropagation(); openPdfItem(item); });
    return btn;
  }

  async function renderSlots(){
    slotsEl.innerHTML = '';
    const items = await getAllByGrade(currentGrade);
    const bySlot = new Map(items.map(it=>[Number(it.slotIndex), it]));

    for(let i=0;i<TOTAL_SLOTS;i++){
      const data = bySlot.get(i) || null;
      const slot = document.createElement('div');
      slot.className = 'slot' + (data ? ' filled' : '');
      if(!isAdmin) slot.classList.add('readonly');

      if(!data){
        slot.innerHTML = `<div><div style="font-weight:800;">áƒªáƒáƒ áƒ˜áƒ”áƒšáƒ˜ áƒ¡áƒšáƒáƒ¢áƒ˜ #${i+1}</div><div style="font-size:13px;color:#64748b;">${isAdmin ? 'áƒ“áƒáƒáƒ¬áƒ™áƒáƒáƒ£áƒœáƒ”áƒ— áƒ“áƒáƒ¡áƒáƒ›áƒáƒ¢áƒ”áƒ‘áƒšáƒáƒ“' : 'áƒªáƒáƒ áƒ˜áƒ”áƒšáƒ˜áƒ'}</div></div>`;
        if(isAdmin){ slot.addEventListener('click', ()=> openEditor({ grade: currentGrade, slotIndex: i })); }
      } else {
        const card = document.createElement('div');
        card.className = 'card';

        const thumb = document.createElement('div');
        thumb.className = 'thumb';
        thumb.textContent = 'ğŸ“„';

        const meta = document.createElement('div');
        meta.className = 'meta';
        const name = document.createElement('div');
        name.className = 'name';
        name.textContent = data.name || 'áƒ“áƒáƒ™áƒ£áƒ›áƒ”áƒœáƒ¢áƒ˜';

        const desc = document.createElement('div');
        desc.className = 'desc';
        const typeLabel = data.pdfType === 'file' ? 'áƒ¤áƒáƒ˜áƒšáƒ˜' : 'áƒ‘áƒ›áƒ£áƒšáƒ˜';
        const typeDetail = data.pdfType === 'file' ? (data.fileName || 'PDF') : (data.pdfUrl || '');
        desc.textContent = (data.description || '').trim() ? data.description : `${typeLabel}: ${typeDetail}`;
        meta.append(name, desc);

        const actions = document.createElement('div');
        actions.append(renderOpenButton(data));

        card.append(thumb, meta, actions);
        slot.append(card);

        if(isAdmin){ slot.addEventListener('click', ()=> openEditor(data)); }
      }

      slotsEl.append(slot);
    }
  }

  /********************
   * Editor (admin)    *
   ********************/
  const editor = document.getElementById('editor');
  const fId = document.getElementById('f-id');
  const fGrade = document.getElementById('f-grade');
  const fSlot = document.getElementById('f-slot');
  const fName = document.getElementById('f-name');
  const fDesc = document.getElementById('f-desc');
  const fUrl = document.getElementById('f-url');
  const fPdf = document.getElementById('f-pdf');
  const rowLink = document.getElementById('rowLink');
  const rowFile = document.getElementById('rowFile');
  const saveErr = document.getElementById('saveErr');

  function getSelectedType(){
    return document.querySelector('input[name="pdfType"]:checked')?.value || 'link';
  }
  function setSelectedType(v){
    const el = document.querySelector(`input[name="pdfType"][value="${v}"]`);
    if(el) el.checked = true;
    updateTypeUI();
  }
  function updateTypeUI(){
    const t = getSelectedType();
    rowLink.classList.toggle('hidden', t !== 'link');
    rowFile.classList.toggle('hidden', t !== 'file');
  }
  document.querySelectorAll('input[name="pdfType"]').forEach(r=> r.addEventListener('change', updateTypeUI));

  function openEditor(data){
    if(!isAdmin){ alert('áƒ áƒ”áƒ“áƒáƒ¥áƒ¢áƒ˜áƒ áƒ”áƒ‘áƒ˜áƒ¡ áƒ£áƒ¤áƒšáƒ”áƒ‘áƒ áƒáƒ  áƒ’áƒáƒ¥áƒ•áƒ—.'); return; }
    saveErr.classList.add('hidden');
    saveErr.textContent = '';

    fId.value = data.id ? String(data.id) : '';
    fGrade.value = data.grade || currentGrade;
    fSlot.value = String(data.slotIndex ?? 0);

    fName.value = data.name || '';
    fDesc.value = data.description || '';

    fUrl.value = data.pdfUrl || '';
    try{ fPdf.value = ''; }catch{}

    setSelectedType(data.pdfType || 'link');
    editor.showModal();
  }

  editor.querySelector('form').addEventListener('submit', async (e)=>{
    e.preventDefault();
    if(!isAdmin) return;

    let id = fId.value ? Number(fId.value) : undefined;
    const grade = String(fGrade.value);
    const slotIndex = Number(fSlot.value);

    const name = fName.value.trim();
    const description = fDesc.value.trim();
    const pdfType = getSelectedType();

    if(!name){ saveErr.textContent = 'áƒ¨áƒ”áƒ˜áƒ§áƒ•áƒáƒœáƒ”áƒ— áƒ¡áƒáƒ®áƒ”áƒšáƒ˜.'; saveErr.classList.remove('hidden'); return; }

    if(id === undefined){
      const existingBySlot = await getByGradeSlot(grade, slotIndex);
      if(existingBySlot) id = existingBySlot.id;
    }

    const existing = (id !== undefined && !Number.isNaN(id)) ? (await getAllByGrade(grade)).find(x=>x.id===id) : null;

    const item = {
      grade, slotIndex,
      name, description,
      pdfType,
      createdAt: existing?.createdAt || Date.now()
    };
    if(id !== undefined && !Number.isNaN(id)) item.id = id;

    if(pdfType === 'link'){
      const u = normalizeUrl(fUrl.value);
      if(!u){ saveErr.textContent='áƒ¨áƒ”áƒ˜áƒ§áƒ•áƒáƒœáƒ”áƒ— PDF áƒ‘áƒ›áƒ£áƒšáƒ˜.'; saveErr.classList.remove('hidden'); return; }
      try{ new URL(u); }catch{ saveErr.textContent='áƒ‘áƒ›áƒ£áƒšáƒ˜ áƒáƒ áƒáƒ¡áƒ¬áƒáƒ áƒ˜áƒ.'; saveErr.classList.remove('hidden'); return; }
      item.pdfUrl = u;
      item.pdfBlob = null;
      item.fileName = null;
    } else {
      const file = fPdf.files && fPdf.files[0];
      if(file){
        if(file.type !== 'application/pdf'){
          saveErr.textContent='áƒáƒ˜áƒ áƒ©áƒ˜áƒ”áƒ— PDF áƒ¤áƒáƒ˜áƒšáƒ˜.'; saveErr.classList.remove('hidden'); return;
        }
        item.pdfBlob = file;
        item.fileName = file.name || 'PDF';
      } else if(existing && existing.pdfType === 'file' && existing.pdfBlob){
        item.pdfBlob = existing.pdfBlob;
        item.fileName = existing.fileName || 'PDF';
      } else {
        saveErr.textContent='áƒáƒ˜áƒ áƒ©áƒ˜áƒ”áƒ— PDF áƒ¤áƒáƒ˜áƒšáƒ˜.'; saveErr.classList.remove('hidden'); return;
      }
      item.pdfUrl = null;
    }

    try{
      await putItem(item);
      editor.close();
      await renderSlots();
    }catch(err){
      console.error(err);
      saveErr.textContent = 'áƒ¨áƒ”áƒœáƒáƒ®áƒ•áƒ˜áƒ¡ áƒ¨áƒ”áƒªáƒ“áƒáƒ›áƒ: ' + (err?.message || err);
      saveErr.classList.remove('hidden');
    }
  });

  async function seedListIfMissing(list){
    for(const it of list){
      const existing = await getByGradeSlot(it.grade, it.slotIndex);
      if(existing) continue;
      await putItem({
        grade: it.grade,
        slotIndex: it.slotIndex,
        name: it.name,
        description: it.description || '',
        pdfType: 'link',
        pdfUrl: it.pdfUrl,
        pdfBlob: null,
        fileName: null,
        createdAt: Date.now()
      });
    }
  }

  // Boot
  ensureLogin();
  (async ()=>{
    try{
      await seedListIfMissing(SEED_ITEMS_GRADE_6);
      await seedListIfMissing(SEED_ITEMS_GRADE_7);
      await seedListIfMissing(SEED_ITEMS_GRADE_8);
    }catch(e){ console.warn('Seeding failed', e); }
  })();

  document.querySelectorAll('.grade-btn')[0]?.focus();
  </script>
</body>
</html>
